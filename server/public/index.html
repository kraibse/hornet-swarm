<!DOCTYPE html>

<head>

    <title>Simple realtime chatroom</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/style.css">

</head>
<body>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <div id='cli' class="mx-auto shadow-xl">
        <div id='terminal-top' class='f-right'>
            <p><span id="username">kraibse</span>@<span id="host">fenrir</span></p>
        </div>

        <div>
            <!-- output -->
            <textarea id="terminal" rows="12" readonly class="shadow-m"></textarea>        
        
            <!-- input -->
            <form action="" class="">
                <input id="m" class="w-100 b-none" placeholder="Enter your message..." class="d-inline" autocomplete="off">
            </form>
        </div>

    </div>


    <!-- socket dependencies -->
    <script src="/socket.io/socket.io.js"></script>
    <script>

        const socket = io();

        
        socket.emit("register", "Web-Terminal");
        
        $('form').submit( function(e) {
            e.preventDefault();
            var name = $('#host').text();
            let command = $("#m").val();
            
            socket.emit("send-command", {client: name, cmd: command}); // $('#m').val()})
      		// $('#m').val();
            return false;
        });


        // display on the console
        socket.on("new-message", function (msg) {
            let terminal = $('#terminal');
            let content = terminal.val();

            terminal.val(content + msg + "\n"); //append($("<li>").text(msg))
        
            if(terminal.length)
                terminal.scrollTop(terminal[0].scrollHeight - terminal.height());
        });


        // clears the console
        socket.on('clear-terminal', () => {
            let terminal = $('#terminal');
            terminal.val('');
        });

    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    
</body>
</html>